var path = require("path"),
    fs = require('fs'),
    mime = require("./mime").types;

exports.iToChar = function(length){
    
    var buf = new Buffer(4);
    buf[0]=0;
    buf[1]=0;
    buf[2]=0;
    buf[3]=0;
    
    for(var i=0;i<4;i++){
        buf[i]=length%256;
        length =(length-buf[i])/256;
        if(length==0)return buf;
    }
    return buf;
}
exports.aToShort = function(buf){
    return buf[1]*256+buf[0];
}
exports.sendFile = function (fileName,res) {

    var ext = path.extname(fileName).slice(1);
    if(ext){
         var contentType = mime[ext] || "text/plain";
          fs.exists(fileName, function (exists) {
         	  if(exists){
         	       fs.readFile(fileName, 'binary', function(err, file) {
         	           if(err){
         	                console.log("err:"+err);
         	                res.writeHead(500, {'Content-Type': contentType});
         	                res.end(err);
         	            }else{
         	                console.log("success");
         	                res.writeHead(200, {'Content-Type': contentType});
         	                res.write(file,'binary');
         	                res.end(); 
         	           }
         	        }); 
         	       }else {
         	          console.log("not exists");
         	       	  res.writeHead(404, {'Content-Type': contentType});
         	       	  res.end();
         	       }
         	  });  
    }    
}
exports.getFile = function (fileName,encoding,callBack) {//encoding= 'utf8'
     fs.exists(fileName, function (exists) {
          if(exists){
              fs.readFile(fileName, encoding, function(err, file) {
                      if(err){
                          callBack(err,null);
                      }else{
                          callBack(null,file);
                      }
                      });
              
          }else {
               callBack(null,null);
          }
     });
}
function createFile(fileName,fileContent){
    fs.writeFile(fileName, fileContent,encoding='utf8',
                 function (err) {
                    if (err){
                        console.log("err:"+err);
                    }else{
                        console.log('It\'s saved!');
                    }
                 });
}
exports.saveFile = function(dir,fileName,fileContent){
    fs.exists(dir, function (exists)
              { if(exists){
                   console.log(dir);
                   createFile(fileName, fileContent);
              }else{
                   fs.mkdir(dir,0755,function(){createFile(fileName, fileContent);});
              }
              });

}
exports.createDir = function (dir,cb) {
    fs.exists(dir, function (exists)
              {
               if(exists){
                  if(cb)cb();
              }else{
                  fs.mkdir(dir,0755,function(){if(cb)cb();});
              }
            });
}


