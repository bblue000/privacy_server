/**
 * Created by Yin Yong on 2014/5/30.
 */

var exp = exports,
	util = require('util'),
	mysql = require('mysql')
	;
	
var pool  = mysql.createPool({
	host     			: 'localhost',
	user     			: 'root',
	password 			: '05237486784',
	database 			: 'privacy_app',
	multipleStatements 	: true
});

exp.getConnection = function(callback) {
	pool.getConnection(callback);
};

exp.findAll = function(tabName, callback) {
	exp.getConnection(function(err, connection) {
		if (checkErrAndReleaseConnection(err, connection, callback)) return;
		
		var sql = util.format('SELECT * FROM %s ;', tabName);
		var query = connection.query(sql, callback);
		console.log('findAll sql = ', query);
	});
};

exp.find = function(params) {
	pool.getConnection(function(err, connection) {
		if (checkErrAndReleaseConnection(connection, callback)) return;
		var query = connection.query(params);
		console.log('findAll sql = ', query);
	}
}

exp.insert = function(params) {
	pool.getConnection(function(err, connection) {
		if (checkErrAndReleaseConnection(connection, callback)) return;
		var query = connection.query(params);
		console.log('findAll sql = ', query);
	}
}

function checkTableName(tabName) {
	if (!tabName || !(tabName instanceof String)) {
		throw new Error('undefined table name');
	}
}

function checkErrAndReleaseConnection(err, connection, callback) {
	if (err) {
		callback(err);
		connection.release();
		// Don't use the connection here, it has been returned to the pool.
		return err;
	}
}